@{
	Layout = "~/Views/Shared/_Layout.cshtml";
	ViewData["Title"] = "Dashboard";
}

<div class="container-fluid py-3">
	<h2 class="mt-3 mb-4">Dashboard</h2>

	<!-- Touch-friendly navigation cards -->
	@* <div class="row g-3 mb-4">
		<div class="col-6 col-md-3">
			<a asp-controller="Employees" asp-action="Index" class="text-decoration-none">
				<div class="card shadow-sm border-0 h-100 touch-card">
					<div class="card-body text-center p-4">
						<i class="bi bi-people fs-1 text-primary mb-3"></i>
						<h5 class="fw-semibold mb-2">Employees</h5>
						<p class="text-muted small mb-0">Manage Staff</p>
					</div>
				</div>
			</a>
		</div>
		<div class="col-6 col-md-3">
			<a asp-controller="Customers" asp-action="Index" class="text-decoration-none">
				<div class="card shadow-sm border-0 h-100 touch-card">
					<div class="card-body text-center p-4">
						<i class="bi bi-person-lines-fill fs-1 text-success mb-3"></i>
						<h5 class="fw-semibold mb-2">Customers</h5>
						<p class="text-muted small mb-0">View Guests</p>
					</div>
				</div>
			</a>
		</div>
		<div class="col-6 col-md-3">
			<a asp-controller="Invoices" asp-action="Index" class="text-decoration-none">
				<div class="card shadow-sm border-0 h-100 touch-card">
					<div class="card-body text-center p-4">
						<i class="bi bi-receipt fs-1 text-warning mb-3"></i>
						<h5 class="fw-semibold mb-2">Invoices</h5>
						<p class="text-muted small mb-0">Billing</p>
					</div>
				</div>
			</a>
		</div>
		<div class="col-6 col-md-3">
			<a asp-controller="Payments" asp-action="Index" class="text-decoration-none">
				<div class="card shadow-sm border-0 h-100 touch-card">
					<div class="card-body text-center p-4">
						<i class="bi bi-cash-coin fs-1 text-danger mb-3"></i>
						<h5 class="fw-semibold mb-2">Payments</h5>
						<p class="text-muted small mb-0">Transactions</p>
					</div>
				</div>
			</a>
		</div>
	</div>
 *@
	<!-- Touch-friendly quick actions -->
	<div class="row g-3 mb-4">
		<div class="col-12">
			<div class="card shadow-sm border-0">
				<div class="card-header bg-light">
					<h5 class="mb-0 fw-semibold">Quick Actions</h5>
				</div>
				<div class="card-body p-4">
					<div class="row g-3">
						<div class="col-6 col-md-4">
							<a asp-controller="Invoices" asp-action="Create" class="btn btn-primary btn-lg w-100 py-3">
								<i class="bi bi-plus-circle fs-4 me-2"></i>
								<div>New Invoice</div>
							</a>
						</div>
						<div class="col-6 col-md-4">
							<a asp-controller="Customers" asp-action="Create" class="btn btn-outline-secondary btn-lg w-100 py-3">
								<i class="bi bi-person-plus fs-4 me-2"></i>
								<div>Add Customer</div>
							</a>
						</div>
						<div class="col-6 col-md-4">
							<a asp-controller="Expenses" asp-action="Create" class="btn btn-outline-secondary btn-lg w-100 py-3">
								<i class="bi bi-wallet2 fs-4 me-2"></i>
								<div>Add Expense</div>
							</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
    <!-- Filters -->
    <div class="row g-3 mb-3 align-items-end">
        <div class="col-12 col-md-3">
            <label class="form-label fw-semibold">From</label>
            <input type="date" id="fromDate" class="form-control form-control-sm" />
        </div>
        <div class="col-12 col-md-3">
            <label class="form-label fw-semibold">To</label>
            <input type="date" id="toDate" class="form-control form-control-sm" />
        </div>
        <div class="col-12 col-md-3 filter-section">
            <button id="btnApply" class="btn btn-primary btn-sm mt-3 mt-md-0 ms-2"><i class="bi bi-funnel"></i> Apply</button>
            <button id="btnToday" class="btn btn-outline-secondary btn-sm mt-3 mt-md-0 ms-2">Today</button>
            <button id="btnMonth" class="btn btn-outline-secondary btn-sm mt-3 mt-md-0 ms-2">Month</button>
            <button id="btnYear" class="btn btn-outline-secondary btn-sm mt-3 mt-md-0 ms-2">Year</button>
        </div>
    </div>

    <!-- Summary cards (dynamic) -->
    <div class="row g-3 mb-4">
        @if (ViewBag.IsAdmin == true)
        {
            <div class="col-6 col-md-3">
                <div class="card shadow-sm border-0 rounded-3 p-3 text-center bg-success text-white">
                    <i class="bi bi-cash-coin fs-2 mb-2"></i>
                    <h6>Total Revenue</h6>
                    <h4 id="tileTotalRevenue" class="fw-bold">LKR 0.00</h4>
                </div>
            </div>
        }

        <div class="col-6 col-md-3">
            <div class="card shadow-sm border-0 rounded-3 p-3 text-center bg-primary text-white">
                <i class="bi bi-egg-fried fs-2 mb-2"></i>
                <h6>Restaurant Revenue</h6>
                <h4 id="tileRestaurantRevenue" class="fw-bold">LKR 0.00</h4>
            </div>
        </div>

        <div class="col-6 col-md-3">
            <div class="card shadow-sm border-0 rounded-3 p-3 text-center bg-info text-dark">
                <i class="bi bi-receipt fs-2 mb-2"></i>
                <h6>Service Charges</h6>
                <h4 id="tileServiceCharges" class="fw-bold">LKR 0.00</h4>
            </div>
        </div>

        <div class="col-6 col-md-3">
            <div class="card shadow-sm border-0 rounded-3 p-3 text-center bg-secondary text-white">
                <i class="bi bi-basket2 fs-2 mb-2"></i>
                <h6>Laundry Revenue</h6>
                <h4 id="tileLaundryRevenue" class="fw-bold">LKR 0.00</h4>
            </div>
        </div>

        <div class="col-6 col-md-3">
            <div class="card shadow-sm border-0 rounded-3 p-3 text-center bg-danger text-white">
                <i class="bi bi-bus-front fs-2 mb-2"></i>
                <h6>Tour Revenue</h6>
                <h4 id="tileTourRevenue" class="fw-bold">LKR 0.00</h4>
            </div>
        </div>

        <div class="col-6 col-md-3">
            <div class="card shadow-sm border-0 rounded-3 p-3 text-center bg-warning text-dark">
                <i class="bi bi-wallet2 fs-2 mb-2"></i>
                <h6>Expenses</h6>
                <h4 id="tileExpenses" class="fw-bold">LKR 0.00</h4>
            </div>
        </div>
    </div>

   @*  <!-- Middle section: Tables -->
    <div class="row g-4">
        <div class="col-lg-6">
            <div class="card shadow-sm border-0 rounded-3">
                <div class="card-header bg-light fw-semibold">Recent Bookings</div>
                <div class="card-body p-0">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Guest</th>
                                <th>Room</th>
                                <th>Check-In</th>
                                <th>Check-Out</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>John Perera</td>
                                <td>Deluxe #203</td>
                                <td>16 Oct</td>
                                <td>18 Oct</td>
                            </tr>
                            <tr>
                                <td>Kasun Silva</td>
                                <td>Suite #101</td>
                                <td>15 Oct</td>
                                <td>20 Oct</td>
                            </tr>
                            <tr>
                                <td>Mary Rodrigo</td>
                                <td>Standard #305</td>
                                <td>16 Oct</td>
                                <td>17 Oct</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card shadow-sm border-0 rounded-3">
                <div class="card-header bg-light fw-semibold">Recent Expenses</div>
                <div class="card-body p-0">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Description</th>
                                <th>Date</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Kitchen Supplies</td>
                                <td>16 Oct</td>
                                <td>LKR 5,200</td>
                            </tr>
                            <tr>
                                <td>Room Maintenance</td>
                                <td>15 Oct</td>
                                <td>LKR 8,000</td>
                            </tr>
                            <tr>
                                <td>Staff Salary</td>
                                <td>14 Oct</td>
                                <td>LKR 19,300</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div> *@
</div>


@section Scripts {
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
        function formatCurrency(value) {
            const num = Number(value || 0);
            return 'LKR ' + num.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function loadMetrics(ele) {
            const from = $('#fromDate').val();
            const to = $('#toDate').val();

            $('.btn', $(".filter-section")).removeClass("btn-primary").addClass("btn-outline-secondary");
            ele.removeClass("btn-outline-secondary").addClass("btn-primary");

            $.getJSON('/Dashboard/GetMetrics', { from: from, to: to }, function (res) {
                if (res && res.success && res.data) {
                    if (res.isAdmin && $('#tileTotalRevenue').length) {
                        $('#tileTotalRevenue').text(formatCurrency(res.data.totalRevenue));
                    }
                    $('#tileExpenses').text(formatCurrency(res.data.totalExpenses));
                    $('#tileRestaurantRevenue').text(formatCurrency(res.data.restaurantRevenue));
                    $('#tileServiceCharges').text(formatCurrency(res.data.serviceCharges));
                    $('#tileLaundryRevenue').text(formatCurrency(res.data.laundryRevenue));
                    $('#tileTourRevenue').text(formatCurrency(res.data.tourRevenue));
                }
            });
        }

        $(function () {
            // Default to today
            const today = new Date().toISOString().slice(0, 10);
            $('#fromDate').val(today);
            $('#toDate').val(today);
            loadMetrics($('#btnApply', $(".filter-section")));

            $('#btnApply').on('click', function () {
                loadMetrics($('#btnApply', $(".filter-section")));
            });

            $('#btnToday').on('click', function () {
                const t = new Date().toISOString().slice(0, 10);
                $('#fromDate').val(t);
                $('#toDate').val(t);

                loadMetrics($('#btnToday', $(".filter-section")));
            });

            $('#btnMonth').on('click', function () {
                const now = new Date();

                // Get first day of current month (local time)
                const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);

                // Format to YYYY-MM-DD in local time
                const formatDate = (d) =>
                    d.getFullYear() + '-' +
                    String(d.getMonth() + 1).padStart(2, '0') + '-' +
                    String(d.getDate()).padStart(2, '0');

                $('#fromDate').val(formatDate(firstDay));
                $('#toDate').val(formatDate(now));

                loadMetrics($('#btnMonth', $(".filter-section")));
            });

            $('#btnYear').on('click', function () {
                const now = new Date();

                // Get January 1st of the current year
                const firstDayOfYear = new Date(now.getFullYear(), 0, 1);

                // Format date to YYYY-MM-DD (local)
                const formatDate = (d) =>
                    d.getFullYear() + '-' +
                    String(d.getMonth() + 1).padStart(2, '0') + '-' +
                    String(d.getDate()).padStart(2, '0');

                $('#fromDate').val(formatDate(firstDayOfYear));
                $('#toDate').val(formatDate(now));

                loadMetrics($('#btnYear', $(".filter-section")));
            });
        });
    </script>
}
