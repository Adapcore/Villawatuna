@model X.PagedList.IPagedList<HotelManagement.Models.Entities.Payment>

@using HotelManagement.Helper
@{
    ViewData["Title"] = "Payments";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="~/css/payments-index.css?v=@Configuration["Assets:Version"]" />

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold text-primary mb-0">💲Payments</h2>
    </div>

    <!-- 🔹 Desktop Table -->
    <div class="payments-table-desktop">
        @if (Model != null && Model.Any())
        {
            <div class="table-responsive shadow-sm">
                <table class="table table-striped table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th>Payment ID</th>
                            <th>Date</th>
                            <th>Invoice No</th>
                            <th>Type</th>
                            <th>Reference</th>
                            <th class="text-end">Amount</th>
                            <th style="width: 160px;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var payment in Model)
                        {
                            <tr>
                                <td>@payment.ID</td>
                                <td>@payment.Date.ToString("dd MMM yyyy")</td>
                                <td>@payment.InvoiceNo</td>
                                <td>@EnumHelper.GetDisplayName(payment.Type)</td>
                                <td>@(payment.Reference ?? "-")</td>
                                <td class="text-end fw-bold">@payment.Amount.ToString("N2")</td>
                                <td>
                                    @* Actions can be added here if needed *@
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <div class="alert alert-info">
                No payments found.
            </div>
        }
    </div>

    <!-- 🔹 Mobile Card Layout -->
    <div class="payments-table-mobile">
        @if (Model != null && Model.Any())
        {
            // Group payments by date (descending order)
            var groupedPayments = Model
                .OrderByDescending(p => p.Date)
                .ThenByDescending(p => p.ID)
                .GroupBy(p => p.Date.Date)
                .ToList();

            @foreach (var dateGroup in groupedPayments)
            {
                <div class="payment-date-group">
                    <div class="payment-date-header">
                        <h6 class="payment-date-title">@dateGroup.Key.ToString("MMM dd, yyyy")</h6>
                    </div>

                    @foreach (var payment in dateGroup)
                    {
                        var paymentTypeName = $"Invoice #{payment.InvoiceNo}";

                        <div class="payment-row-wrapper">
                            <div class="payment-row-compact payment-status-success">
                                <div class="payment-row-header">
                                    <div class="payment-type-icon">
                                        <i class="bi bi-credit-card"></i>
                                    </div>
                                    <div class="payment-invoice-name">
                                        @paymentTypeName
                                    </div>
                                    <div class="payment-amount">
                                        @payment.Amount.ToString("N2")
                                    </div>
                                </div>
                                <div class="payment-row-footer">
                                    <span class="payment-number">
                                        <span class="payment-number-label">PAY No</span>
                                        <span class="payment-number-value">#@payment.ID</span>
                                    </span>
                                    <span class="payment-type-badge">@EnumHelper.GetDisplayName(payment.Type)</span>
                                    <a href="@Url.Action("Details", "Payments", new { id = payment.ID })" class="btn-view-payment">
                                        <i class="bi bi-eye"></i> View
                                    </a>
                                    @if (payment.CreatedByMember != null && !string.IsNullOrEmpty(payment.CreatedByMember.Name))
                                    {
                                        <span class="payment-creator">@payment.CreatedByMember.Name</span>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
        }
        else
        {
            <div class="text-center text-muted py-5">
                <i class="bi bi-inbox fs-1"></i>
                <p class="mt-3 fs-5">No payments found.</p>
            </div>
        }
    </div>
</div>
@await Html.PartialAsync("_Pagination", Model)