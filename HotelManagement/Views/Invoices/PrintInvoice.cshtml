@using HotelManagement.Enums
@model Invoice

@{
    ViewBag.Title = "Print Invoice";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-4" id="invoiceContainer">
    <div class="text-center mb-3">
        <h3 class="fw-bold">My Hotel / Restaurant</h3>
        <p>Address Line 1 | Address Line 2</p>
        <p>Phone: 0123-456789</p>
    </div>

    <hr />

    <div class="row mb-3">
        <div class="col-6">
            <strong>Invoice No:</strong> @Model.InvoiceNo<br />
            <strong>Date:</strong> @Model.Date.ToString("yyyy-MM-dd")<br />
            <strong>Status:</strong> @Model.Status
        </div>
        <div class="col-6 text-end">
            <strong>Customer:</strong> @Model.Customer?.FirstName @Model.Customer?.LastName<br />
            <strong>Customer Phone:</strong> @Model.Customer?.ContactNo<br />
            <strong>Reference No:</strong> @Model.ReferenceNo
        </div>
    </div>

    <div class="mb-3">
        <strong>Note:</strong> @Model.Note
    </div>

    <table class="table table-bordered table-sm text-center">
        <thead class="table-light">
            <tr>
                @if (Model.Type == InvoiceType.Stay)
                {
                    <th>Room Type</th>
                    <th>Check-In</th>
                    <th>Check-Out</th>
                    <th># Room / Note</th>
                    <th># Nights</th>
                    <th>Price / Night</th>
                    <th>Amount</th>
                }
                else
                {
                    <th>Description</th>
                    <th>Note</th>
                    @if (Model.Type == InvoiceType.Laundry)
                    {
                        <th>Kg</th>
                        <th>Price</th>
                    }
                    else
                    {
                        <th>Qty</th>
                        <th>Unit Price</th>
                    }
                    <th>Amount</th>
                }

            </tr>
        </thead>
        <tbody>
            @foreach (var detail in Model.InvoiceDetails)
            {
                <tr>
                    <td>@detail.Item?.Name</td>
                    @if (Model.Type == InvoiceType.Stay)
                    {
                        <td>@detail.CheckIn?.ToShortDateString()</td>
                        <td>@detail.CheckOut?.ToShortDateString()</td>
                    }
                    <td>@detail.Note</td>
                    <td>@detail.Quantity</td>
                    <td>@detail.UnitPrice.ToString("N2")</td>
                    <td>@detail.Amount.ToString("N2")</td>
                </tr>
            }
        </tbody>
    </table>

    <div class="row mt-3">
        <div class="col-6 offset-6">
            <div class="d-flex justify-content-between">
                <strong>Cury SubTotal:</strong>
                <span>@Model.CurySubTotal.ToString("N2") @Model.Currency</span>
            </div>
            <hr />
            @if (Model.Type == InvoiceType.Dining)
            {
                <div class="d-flex justify-content-between">
                    <strong>Subtotal:</strong>
                    <span>@Model.SubTotal.ToString("N2")</span>
                </div>
                <div class="d-flex justify-content-between">
                    <strong>Service Charge:</strong>
                    <span>@Model.ServiceCharge.ToString("N2")</span>
                </div>
                <hr />
            }
            <div class="d-flex justify-content-between fw-bold">
                <strong>Gross Total:</strong>
                <span>@Model.GrossAmount.ToString("N2")</span>
            </div>
            <hr />
            @if (Model.Status != InvoiceStatus.InProgress)
            {
                <div class="d-flex justify-content-between">
                    <strong>Total Paid:</strong>
                    <span>@Model.TotalPaid.ToString("N2")</span>
                </div>
                <div class="d-flex justify-content-between">
                    <strong>Balance Amount:</strong>
                    <span>@Model.Balance.ToString("N2")</span>
                </div>
            }
        </div>
    </div>

    <div class="text-center mt-4">
        <p>Thank you for your business!</p>
    </div>
</div>

<div class="text-center mt-3 no-print">
    <button onclick="printInvoice()" class="btn btn-success">
        <i class="bi bi-printer"></i> Print Invoice
    </button>
</div>

<style>
    /* POS-friendly printing */
    @@media print {
        body * {
            visibility: hidden;
        }

        #invoiceContainer, #invoiceContainer * {
            visibility: visible;
        }

        #invoiceContainer {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            font-size: 12pt;
        }

        .no-print {
            display: none;
        }

        table th, table td {
            padding: 4px;
        }
    }
</style>

<script>
    function printInvoice() {
        window.print();
    }
</script>
