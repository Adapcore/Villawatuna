@model HotelManagement.Models.Entities.Invoice

@{
    Layout = null; // Remove layout for POS printing
    ViewBag.Title = "Print Invoice";
    // choose "width-80" or "width-58" — you can change here or via CSS
    var paperClass = "width-80"; 
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Invoice Print</title>
    <style>
        /* POS Printer Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Courier New', monospace; 
            font-size: 12px; 
            line-height: 1.2;
            background: white;
            color: black;
        }
        
        /* paper widths: 58mm and 80mm */
        .width-58 { width: 58mm; max-width: 58mm; }
        .width-80 { width: 80mm; max-width: 80mm; }
        
        .receipt-container {
            margin: 0 auto;
            padding: 2mm;
        }
        
        .receipt-content {
            background: white;
            color: black;
        }
        
        /* Invoice header */
        .invoice-header {
            text-align: center;
            margin-bottom: 4mm;
            border-bottom: 1px dashed #000;
            padding-bottom: 2mm;
        }
        
        .invoice-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 1mm;
        }
        
        .invoice-meta {
            font-size: 10px;
            margin-bottom: 2mm;
        }
        
        /* Items table */
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin: 2mm 0;
            font-size: 10px;
        }
        
        .items-table th {
            text-align: left;
            border-bottom: 1px solid #000;
            padding: 1mm 0;
            font-weight: bold;
        }
        
        .items-table td {
            padding: 1mm 0;
            border-bottom: 1px dotted #ccc;
        }
        
        .item-name { width: 50%; }
        .item-qty { width: 15%; text-align: center; }
        .item-price { width: 17.5%; text-align: right; }
        .item-total { width: 17.5%; text-align: right; }
        
        /* Totals */
        .totals {
            margin-top: 3mm;
            font-size: 10px;
        }
        
        .total-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1mm;
        }
        
        .gross-total {
            font-weight: bold;
            font-size: 12px;
            border-top: 1px solid #000;
            padding-top: 1mm;
            margin-top: 2mm;
        }
        
        /* Print styles */
        @@media print {
            body { margin: 0; padding: 0; }
            .receipt-container { margin: 0; }
            .no-print { display: none !important; }
        }
        
        @@page { 
            size: auto; 
            margin: 0; 
        }
    </style>
</head>
<body>
    <div class="receipt-container @paperClass">
        <div class="receipt-content">
            <!-- Invoice Header -->
            <div class="invoice-header">
                <div class="invoice-title">INVOICE</div>
                <div class="invoice-meta">
                    <div>Invoice No: @Model.InvoiceNo</div>
                    <div>Date: @Model.Date.ToString("yyyy-MM-dd HH:mm")</div>
                    @if (Model.Customer != null)
                    {
                        <div>Customer: @Model.Customer.FirstName @Model.Customer.LastName</div>
                    }
                    @if (!string.IsNullOrWhiteSpace(Model.ReferenceNo))
                    {
                        <div>Ref: @Model.ReferenceNo</div>
                    }
                </div>
            </div>

            <!-- Items Table -->
            <table class="items-table">
                <thead>
                    <tr>
                        <th class="item-name">Item</th>
                        <th class="item-qty">Qty</th>
                        <th class="item-price">Price</th>
                        <th class="item-total">Total</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var d in Model.InvoiceDetails ?? Enumerable.Empty<HotelManagement.Models.Entities.InvoiceDetail>())
                    {
                        <tr>
                            <td class="item-name">@d.Item?.Name</td>
                            <td class="item-qty">@d.Quantity</td>
                            <td class="item-price">@d.UnitPrice.ToString("F2")</td>
                            <td class="item-total">@d.Amount.ToString("F2")</td>
                        </tr>
                        @if (!string.IsNullOrWhiteSpace(d.Note))
                        {
                            <tr>
                                <td colspan="4" style="font-size: 9px; color: #666; padding-left: 2mm;">Note: @d.Note</td>
                            </tr>
                        }
                    }
                </tbody>
            </table>

            <!-- Totals -->
            <div class="totals">
                <div class="total-line">
                    <span>Sub Total:</span>
                    <span>@Model.SubTotal.ToString("F2")</span>
                </div>
                <div class="total-line">
                    <span>Service Charge:</span>
                    <span>@Model.ServiceCharge.ToString("F2")</span>
                </div>
                <div class="total-line gross-total">
                    <span>GROSS TOTAL:</span>
                    <span>@Model.GrossAmount.ToString("F2")</span>
                </div>
                <div style="height:8px;"></div>

                <!-- footer -->
                <div style="text-align:center; font-size:10px;">
                    Thank you for your visit!
                    <div style="height:4px;"></div>
                    <div style="font-size:9px; color:#666;">Powered by Adapcore</div>
                </div>

                <div style="height:6px;"></div>
            </div>
        </div>
    </div>

    <!-- Auto print and close -->
    <script>
        window.onload = function() {
            // Auto print when page loads
            window.print();
            
            // Close window after printing (with delay to ensure print dialog is handled)
            setTimeout(function() {
                window.close();
            }, 1000);
        };
    </script>
</body>
</html>
